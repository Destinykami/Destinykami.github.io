---
title: '南京大学计算机基础PA1'
date: 2024/01/28
update: 2024/01/28
permalink: /posts/2024/01/nju-pa-1
excerpt: '南京大学计算机基础PA1'
tags:
  - OS
---
这是南京大学计算机基础PA实验，作为一个过程记录。
# PA1.1 基础设施
简易调试器(Simple Debugger, sdb)是NEMU中一项非常重要的基础设施. 我们知道NEMU是一个用来执行其它客户程序的程序, 这意味着, NEMU可以随时了解客户程序执行的所有信息. 然而这些信息对外面的调试器(例如GDB)来说, 是不容易获取的. 例如在通过GDB调试NEMU的时候, 你将很难在NEMU中运行的客户程序中设置断点, 但对于NEMU来说, 这是一件不太困难的事情.

为了提高调试的效率, 同时也作为熟悉框架代码的练习, 我们需要在monitor中实现一个具有如下功能的简易调试器 (相关部分的代码在nemu/src/monitor/sdb/目录下)。

## 单步执行  si [N]
参考cmd_quit的实现，调用cpu_exec函数即可。
```c
static int cmd_si(char *args){
  int step=1;
  if(args!=NULL){
    step=atoi(args);
  }
  cpu_exec(step);
  return 0;
}
```
## 打印程序状态 info CMD
`info r` :打印寄存器状态  
`info w` :打印监视点信息  
这里暂时只实现了打印寄存器，有关监视点的概念还没学到。  
```c
//sdb.c
//打印程序状态
static int cmd_info(char *args){
  if(args==NULL){
    //检查参数是否正确
    Log("Usage: info r (or info u)");
    return 0;
  }
  switch (*args)
  {
  case 'r':
    isa_reg_display();
    break;
  case 'w':
    printf("Todo:打印监视点信息");
    break;
  default:
    Log("Usage: info r (or info u)");
    break;
  }
  return 0;
}
//reg.c
//打印寄存器状态
void isa_reg_display() {
  for(int i=0;i<sizeof(regs)/sizeof(char*);i++){
    printf("%s : %d\n",regs[i],cpu.gpr[i]);
  }
}
```